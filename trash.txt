import DeployButton from '../components/DeployButton'
import AuthButton from '../components/AuthButton'
import { createClient } from '@/utils/supabase/server'
import ConnectSupabaseSteps from '@/components/ConnectSupabaseSteps'
import SignUpUserSteps from '@/components/SignUpUserSteps'
import Header from '@/components/Header'
import { cookies } from 'next/headers'

export default async function Index() {
  const cookieStore = cookies()

  const canInitSupabaseClient = () => {
    // This function is just for the interactive tutorial.
    // Feel free to remove it once you have Supabase connected.
    try {
      createClient(cookieStore)
      return true
    } catch (e) {
      return false
    }
  }

  const isSupabaseConnected = canInitSupabaseClient()

  return (
    <div className="flex-1 w-full flex flex-col gap-20 items-center">
      <nav className="w-full flex justify-center border-b border-b-foreground/10 h-16">
        <div className="w-full max-w-4xl flex justify-between items-center p-3 text-sm">
          <DeployButton />
          {isSupabaseConnected && <AuthButton />}
        </div>
      </nav>

      <div className="animate-in flex-1 flex flex-col gap-20 opacity-0 max-w-4xl px-3">
        <Header />
        <main className="flex-1 flex flex-col gap-6">
          <h2 className="font-bold text-4xl mb-4">Next steps</h2>
          {isSupabaseConnected ? <SignUpUserSteps /> : <ConnectSupabaseSteps />}
        </main>
      </div>

      <footer className="w-full border-t border-t-foreground/10 p-8 flex justify-center text-center text-xs">
        <p>
          Powered by{' '}
          <a
            href="https://supabase.com/?utm_source=create-next-app&utm_medium=template&utm_term=nextjs"
            target="_blank"
            className="font-bold hover:underline"
            rel="noreferrer"
          >
            Supabase
          </a>
        </p>
      </footer>
    </div>
  )
}


'dodger-blue': 
{  DEFAULT: '#3B82F6', 
 50: '#EBF2FE',  100:
  '#D7E6FD',  200:
   '#B0CDFB',  300:
    '#89B4FA',  400:
     '#629BF8',  500: 
   '#3B82F6',  600: 
   '#0B61EE',  700:
    '#084BB8',  800:
     '#063583',  900:
    '#041F4D',  950:
     '#021532'},




     	<form onSubmit={handleSubmit}>
				{/* Basic Fields */}
				<input
					type="text"
					name="id"
					placeholder="ID"
					value={formData.id}
					onChange={handleChange}
				/>
				<input
					type="text"
					name="vendor_id"
					placeholder="Vendor ID"
					value={formData.vendor_id}
					onChange={handleChange}
				/>
				<input
					type="text"
					name="store_id"
					placeholder="Store ID"
					value={formData.store_id}
					onChange={handleChange}
				/>
				<input
					type="text"
					name="title"
					placeholder="Title"
					value={formData.title}
					onChange={handleChange}
				/>
				<input
					type="text"
					name="status"
					placeholder="Status"
					value={formData.status}
					onChange={handleChange}
				/>
				<input
					type="text"
					name="media"
					placeholder="Media (comma separated)"
					value={formData.media.join(",")}
					onChange={(e) => handleArrayChange(e, "media")}
				/>
				<input
					type="text"
					name="type"
					placeholder="Type"
					value={formData.type}
					onChange={handleChange}
				/>
				<input
					type="text"
					name="brand"
					placeholder="Brand"
					value={formData.brand}
					onChange={handleChange}
				/>
				<input
					type="number"
					name="price"
					placeholder="Price"
					value={formData.price}
					onChange={handleChange}
				/>
				<label>
					On Sale:
					<input
						type="checkbox"
						name="on_sale"
						checked={formData.on_sale}
						onChange={(e) =>
							setFormData({ ...formData, on_sale: e.target.checked })
						}
					/>
				</label>
				<input
					type="number"
					name="cost_of_good"
					placeholder="Cost of Good"
					value={formData.cost_of_good}
					onChange={handleChange}
				/>
				<input
					type="number"
					name="inventory"
					placeholder="Inventory"
					value={formData.inventory}
					onChange={handleChange}
				/>
				<input
					type="text"
					name="sku"
					placeholder="SKU"
					value={formData.sku}
					onChange={handleChange}
				/>
				<textarea
					name="description"
					placeholder="Description"
					value={formData.description}
					onChange={handleChange}
				></textarea>

				{/* Additional Information */}
				<h2>Additional Information</h2>
				{formData.additional_information.map((info, index) => (
					<div key={index}>
						<input
							type="text"
							placeholder="Key"
							value={info.key}
							onChange={(e) =>
								handleAdditionalInfoChange(index, "key", e.target.value)
							}
						/>
						<input
							type="text"
							placeholder="Value"
							value={info.value}
							onChange={(e) =>
								handleAdditionalInfoChange(index, "value", e.target.value)
							}
						/>
					</div>
				))}
				<button type="button" onClick={handleAddAdditionalInfo}>
					Add Additional Info
				</button>

				{/* Variants */}
				<h2>Variants</h2>
				<h3>Size</h3>
				{formData.variants.size.map((variant, index) => (
					<div key={index}>
						<input
							type="text"
							placeholder="Key"
							value={variant.key}
							onChange={(e) =>
								handleVariantChange("size", index, "key", e.target.value)
							}
						/>
						<input
							type="text"
							placeholder="Value"
							value={variant.value}
							onChange={(e) =>
								handleVariantChange("size", index, "value", e.target.value)
							}
						/>
					</div>
				))}
				<button type="button" onClick={() => handleAddVariant("size")}>
					Add Size Variant
				</button>

				<h3>Material</h3>
				{formData.variants.material.map((variant, index) => (
					<div key={index}>
						<input
							type="text"
							placeholder="Key"
							value={variant.key}
							onChange={(e) =>
								handleVariantChange("material", index, "key", e.target.value)
							}
						/>
						<input
							type="text"
							placeholder="Value"
							value={variant.value}
							onChange={(e) =>
								handleVariantChange("material", index, "value", e.target.value)
							}
						/>
					</div>
				))}
				<button type="button" onClick={() => handleAddVariant("material")}>
					Add Material Variant
				</button>

				<h3>Color</h3>
				{formData.variants.color.map((variant, index) => (
					<div key={index}>
						<input
							type="text"
							placeholder="Key"
							value={variant.key}
							onChange={(e) =>
								handleVariantChange("color", index, "key", e.target.value)
							}
						/>
						<input
							type="text"
							placeholder="Value"
							value={variant.value}
							onChange={(e) =>
								handleVariantChange("color", index, "value", e.target.value)
							}
						/>
					</div>
				))}
				<button type="button" onClick={() => handleAddVariant("color")}>
					Add Color Variant
				</button>

				<button type="submit">Submit</button>
			</form>






            	// const handleSignUp = async (e: { preventDefault: () => void }) => {
	// 	e.preventDefault();
	// 	try {
	// 		setSigningIn(true);
	// 		await signUp(email, password);
	// 	} catch (error) {
	// 		console.error("Signup error:", error);
	// 	} finally {
	// 		setSigningIn(false);
	// 		setEmail("");
	// 		setPassword("");
	// 	}
	// };

	// const handleSignIn = async (e: { preventDefault: () => void }) => {
	// 	e.preventDefault();

	// 	try {
	// 		setLoggingIn(true);
	// 		await signInHandler(email, password);
	// 		router.push("/dashboard");
	// 	} catch (error) {
	// 		console.error("Signin error:", error);
	// 	} finally {
	// 		setLoggingIn(false);
	// 		setEmail("");
	// 		setPassword("");
	// 	}
	// };

	// const handleSocialLoginClick = async (provider: Provider) => {
	// 	try {
	// 		if (provider === "github") {
	// 			setGithub(true);
	// 			setGoogle(false);
	// 		} else {
	// 			setGoogle(true);
	// 			setGithub(false);
	// 		}

	// 		await handleSocialLogin(provider);
	// 	} catch (error) {
	// 		console.error("Social login error:", error);
	// 	} finally {
	// 		setGithub(false);
	// 		setGoogle(false);
	// 	}
	// };



    // const [email, setEmail] = useState("");
	// const [password, setPassword] = useState("");
	// const [signingIn, setSigningIn] = useState(false);
	// const [loggingIn, setLoggingIn] = useState(false);
	// const [google, setGoogle] = useState(false);
	// const [github, setGithub] = useState(false);
	// const router = useRouter();


    // const signIn = async (formData: FormData) => {
	// 	"use server";

	// 	const email = formData.get("email") as string;
	// 	const password = formData.get("password") as string;
	// 	const supabase = ServerClient();

	// 	const { error } = await supabase.auth.signInWithPassword({
	// 		email,
	// 		password,
	// 	});

	// 	if (error) {
	// 		return redirect("/login?message=Could not authenticate user");
	// 	}

	// 	return redirect("/store/dashboard");
	// };
	// const signUp = async (formData: FormData) => {
	// 	"use server";

	// 	const origin = headers().get("origin");
	// 	const email = formData.get("email") as string;
	// 	const password = formData.get("password") as string;
	// 	const supabase = ServerClient();

	// 	const { error } = await supabase.auth.signUp({
	// 		email,
	// 		password,
	// 		options: {
	// 			emailRedirectTo: `${origin}/auth/callback`,
	// 		},
	// 	});

	// 	if (error) {
	// 		return redirect("/login?message=Could not authenticate user");
	// 	}

	// 	return redirect("/login?message=Check email to continue sign in process");
	// };

    // import { ServerClient } from "@/supabase/server";
// import { redirect } from "next/navigation";
// import Link from "next/link";
// import { headers } from "next/headers";
// import { SubmitButton } from "../auth/_components/submit-button";

		{/* <Button
								onClick={handleSignUp}
								disabled={
									signingIn || email.length === 0 || password.length === 0
								}
								className="inline-flex items-center justify-center w-full py-3 mb-6 text-sm font-medium transition-colors rounded-md shadow whitespace-nowrap disabled:cursor-not-allowed focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary  text-primary-foreground hover:bg-clr-7"
								// pendingText="Signing up..."
							>
								{signingIn ? "Signing up..." : "Sign Up"}
							</Button> */}
                            		{/* <Button
								// onClick={signIn}
								disabled={
									loggingIn || email.length === 0 || password.length === 0
								}
								className="w-full px-4 py-2 mb-2 border rounded-md border-foreground/20 text-clr-10 bg-background hover:bg-secondary/90 disabled:cursor-not-allowed"
							>
								{loggingIn ? "Logging In ..." : "Log in"}
							</Button> */}




                            fprm

                            "use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { BrowserClient } from "@/supabase/client";
import { FaFacebook } from "react-icons/fa";
import { FcGoogle } from "react-icons/fc";
import { FiLoader } from "react-icons/fi";
import { Provider } from "@supabase/supabase-js";

export default function Login() {
	const router = useRouter();
	const [facebook, setFacebook] = useState(false);
	const [google, setGoogle] = useState(false);
	const [email, setEmail] = useState("");
	const [password, setPassword] = useState("");
	const [login, setLogin] = useState("Log In");
	const [signup, setSignup] = useState("Sign Up");

	const supabase = BrowserClient();

	const signUp = async (e: { preventDefault: () => void }) => {
		e.preventDefault();
		try {
			setSignup("Signing up...");
			const { data: user, error } = await supabase.auth.signUp({
				email,
				password,
				options: {
					emailRedirectTo: `${window.location.origin}/store/dashboard`,
				},
			});

			if (error) {
				console.log("Sign up error:", error.message);
				return;
			}

			router.push("/store/dashboard");
		} catch (error) {
			console.log(error);
		} finally {
			setSignup("Sign Up");
		}
	};

	const signIn = async (e: { preventDefault: () => void }) => {
		e.preventDefault();
		try {
			setLogin("Logging in...");
			const { data: user, error } = await supabase.auth.signInWithPassword({
				email,
				password,
			});

			if (error) {
				console.error("Login error:", error.message);
				return;
			}

			router.push("/store/dashboard");
		} catch (error) {
			console.log(error);
		} finally {
			setLogin("Log In");
		}
	};

	const handleSocialLogin = async (provider: Provider) => {
		try {
			if (provider === "google") {
				setGoogle(true);
			} else if (provider === "facebook") {
				setFacebook(true);
			}
			await supabase.auth.signInWithOAuth({
				provider,
				options: {
					redirectTo: `${window.location.origin}/store/dashboard`,
				},
			});
		} catch (error) {
			console.error("Social login error:", error);
		} finally {
			if (provider === "google") {
				setGoogle(false);
			} else if (provider === "facebook") {
				setFacebook(false);
			}
		}
	};

	return (
		<section className="fixed inset-0 flex items-center justify-between w-full h-screen overflow-hidden bg-center bg-cover bg-background">
			<div className="flex justify-center w-full h-full">
				<Card className="border-none shadow-none bg-none w-[500px] mt-8 sm:mt-6 md:mt-5">
					<CardHeader className="mb-5">
						<div className="flex items-center justify-center w-full">
							<img src="logo-long.svg" alt="logo" width={150} />
						</div>
					</CardHeader>

					<CardContent className="grid gap-2">
						<form className="w-full animate-in" onSubmit={signIn}>
							<div className="grid gap-2 mb-5">
								<Label htmlFor="email" className="text-sm">
									Email
								</Label>
								<Input
									className="rounded-md px-4 py-2 bg-inherit border "
									name="email"
									value={email}
									onChange={(e) => setEmail(e.target.value)}
									placeholder="you@example.com"
									required
								/>
							</div>
							<div className="grid gap-2 mb-8">
								<Label htmlFor="password" className="text-sm">
									Password
								</Label>
								<Input
									className="rounded-md px-4 py-2 bg-inherit border "
									type="password"
									name="password"
									value={password}
									onChange={(e) => setPassword(e.target.value)}
									placeholder="••••••••"
									required
								/>
							</div>
							<Button
								onClick={signUp}
								className="inline-flex items-center justify-center w-full py-3 mb-3 text-sm font-medium transition-colors rounded-md shadow whitespace-nowrap disabled:cursor-not-allowed focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary  text-primary-foreground hover:bg-clr-7"
							>
								{signup}
							</Button>

							<p className="mb-5 text-xs text-center first-letter:uppercase">
								already have an account?
							</p>

							<Button
								type="submit"
								className="w-full px-4 py-2 mb-2 border rounded-md border-foreground/20 text-clr-10 bg-background hover:bg-secondary/90 disabled:cursor-not-allowed"
							>
								{login}
							</Button>
							{/* {searchParams?.message && (
								<p className="mt-4 p-4 bg-foreground/10 text-foreground text-center">
									{searchParams.message}
								</p>
							)} */}
						</form>
						<div className="relative mt-5">
							<div className="absolute inset-0 flex items-center">
								<span className="w-full border-t" />
							</div>
							<div className="relative flex justify-center text-xs uppercase">
								<span className="px-2 bg-background text-muted-foreground">
									Or continue with
								</span>
							</div>
						</div>
						<div className="grid grid-cols-2 gap-6">
							<Button
								variant="outline"
								onClick={() => handleSocialLogin("facebook")}
								disabled={facebook}
								className="disabled:cursor-not-allowed"
							>
								<FaFacebook className="w-4 h-4 mr-2 text-blue-700" />
								Facebook {facebook && <FiLoader className="animate-spin" />}
							</Button>
							<Button
								variant="outline"
								onClick={() => handleSocialLogin("google")}
								disabled={google}
								className="disabled:cursor-not-allowed"
							>
								<FcGoogle className="w-4 h-4 mr-2" />
								Google {google && <FiLoader className="animate-spin" />}
							</Button>
						</div>
					</CardContent>
				</Card>
			</div>
		</section>
	);
}




					{/* <InputOTP
						pattern={REGEXP_ONLY_DIGITS}
						id="input-otp"
						maxLength={6}
						onChange={async (value) => {
							if (value.length === 6) {
								document.getElementById("input-otp")?.blur();
								const res = await verifyOtp({
									email: form.getValues("email"),
									otp: value,
									type: "email",
								});
								const { error } = JSON.parse(res);
								if (error) {
									setVerifyStatus("failed");
								} else {
									setVerifyStatus("success");
									router.push(redirectTo);
								}
							}
						}}
					>
						<InputOTPGroup>
							<InputOTPSlot index={0} className={inputOptClass} />
							<InputOTPSlot index={1} className={inputOptClass} />
							<InputOTPSlot index={2} className={inputOptClass} />
						</InputOTPGroup>
						<InputOTPSeparator />
						<InputOTPGroup>
							<InputOTPSlot index={3} className={inputOptClass} />
							<InputOTPSlot
								index={4}
								className={cn(inputOptClass)}
							/>
							<InputOTPSlot
								index={5}
								className={cn(inputOptClass)}
							/>
						</InputOTPGroup>
					</InputOTP> */}
					<div className="text-sm flex gap-2">
						<p>{"Didn't work?"} </p>
						<span
							className="text-blue-400 cursor-pointer hover:underline transition-all flex items-center gap-2 "
							onClick={async () => {
								if (!isSendAgain) {
									startSendAgain(async () => {
										if (!form.getValues("password")) {
											const json = await postEmail({
												email: form.getValues("email"),
												password:
													form.getValues("password"),
											});

											if (json.error) {
												toast.error(
													"Fail to resend email"
												);
											} else {
												toast.success(
													"Please check your email."
												);
											}
										} else {
											router.replace(
												pathname || "/register"
											);
											form.setValue(
												"email",
												existEmail || ""
											);
											form.setValue("password", "");
											setIsConfirmed(false);
										}
									});
								}
							}}
						>
							<AiOutlineLoading3Quarters
								className={`${
									!isSendAgain
										? "hidden"
										: "block animate-spin"
								}`}
							/>
							Send me another code.
						</span>
					</div>
					<Button
						type="submit"
						className="w-full h-8 bg-indigo-500 hover:bg-indigo-600 transition-all text-white flex items-center gap-2"
						onClick={async () => {
							setIsConfirmed(false);
						}}
					>
						<RiArrowDropLeftFill className=" size-5" />
						Change Email
					</Button>

                    	// const sendVerifyEmail = async (data: z.infer<typeof FormSchema>) => {
	// 	const json = await postEmail({
	// 		email: data.email,
	// 		password: data.password,
	// 	});
	// 	if (!json.error) {
	// 		router.replace(
	// 			(pathname || "/") +
	// 				"?verify=true&email=" +
	// 				form.getValues("email")
	// 		);
	// 		setIsConfirmed(true);
	// 	} else {
	// 		if (json.error.code) {
	// 			toast.error(json.error.code);
	// 		} else if (json.error.message) {
	// 			toast.error(json.error.message);
	// 		}
	// 	}
	// };

	// const inputOptClass = cn({
	// 	" border-green-500": verifyStatus === "success",
	// 	" border-red-500": verifyStatus === "failed",
	// });

	// function onSubmit(data: z.infer<typeof FormSchema>) {
	// 	if (!isPending) {
	// 		startTransition(async () => {
	// 			await sendVerifyEmail(data);
	// 		});
	// 	}
	// }


    // const { data, error } = await supabase
// 	.from("auth.users")
// 	.select("*")
// 	.eq("email", email);
// redirectTo:
// 			window.location.origin + `/auth/callback?next=` + redirectTo,
//         },

// if (error) {
// 	return redirect("/signup?message=Could not create user");
// }
// const user = data[0];
// const { error: error2 } = await supabase
// 	.from("profiles")
// 	.select("*")
// 	.eq("id", user.id)
// 	.insert([
// 		{
// 			display_name: username,
// 		},
// 	]);
// if (error2) {
// 	return redirect("/error?message=Could not create profile");
// }
\

const handleCreatePost = async (data: NoteFormValues) => {
	if (selectedCategoryIds.length === 0) {
		// If no categories are selected, show an error message or take appropriate action
		toast.error("Please enter at least one category before submitting.");
		return; // Exit the function without submitting the form
	}
	let imageUrl = "";
	try {
		setLoading(true);

		if (postImage instanceof File) {
			// Generate a random 10-digit number to stop the error of supabase saying image already exists, incase youre using the same image for different posts
			const randomSuffix = Math.floor(
				1000000000 + Math.random() * 9000000000
			).toString();

			const imageName = `${randomSuffix}-${postImage.name}`;

			const { data: imageUploadResponse, error: imageUploadError } =
				await supabase.storage
					.from("post_images")
					.upload(imageName, postImage, {
						cacheControl: "3600",
						upsert: true,
					});

			if (imageUploadResponse) {
				imageUrl = imageUploadResponse.path;
			} else {
				console.error("Error uploading image:", imageUploadError?.message);
				toast.error("Failed to upload image");
				return;
			}
		}

		const { data: post, error } = await supabase
			.from("posts")
			.insert([
				{
					title: data.title,
					profile_id: userId,
					snippet: data.snippet,
					content: data.content,
					image: `${postImageUrl}${imageUrl}`,
					category_Ids: selectedCategoryIds,
				},
			])
			.select();

		if (post) {
			// Insert records into post_categories for each category ID

			navigate("/posts");
			scrollToTop();

			toast.success("Article Published");
		} else {
			toast.error("Failed to create Post");
		}
	} catch (error: any) {
		console.error("An error occurred:", error.message);
	} finally {
		setLoading(false);
	}
};


// import { Category } from "@/d.types";
// import { createSupabaseServer } from "@/supabase/server";
// import React from "react";

// export default async function page({ params }: { params: { id: string } }) {
// 	const supabase = createSupabaseServer();
// 	const { data: currentUser } = await supabase.auth.getUser();
// 	const userId = currentUser.user?.id;
// 	const { data: categories, error } = await supabase
// 		.from("collection")
// 		.select("*")
// 		.eq("vendor_id", userId as string)
// 		.eq("store_id", params.id);

// 	if (error) {
// 		console.error("Error fetching collections:", error);
// 		return <div>Error loading categories</div>;
// 	}

// 	return categories as Category[];
// }

// 	return (
// 		<div>
// 			{categories.map((category) => (
// 				<div key={category.id} className="category-item">
// 					{category.name}
// 				</div>
// 			))}
// 		</div>
// 	);



{/* const url = `https://qqemuxlyzkbjudzwmfid.supabase.co/rest/v1/category?id=eq.${categoryId}`;
const anonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFxZW11eGx5emtianVkendtZmlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDA2NTAxMDQsImV4cCI6MjAxNjIyNjEwNH0.sqBedeuuGl6Osr3UBg_y8kUep9eFwFr_SADIR1v_nHI"; */}
//https://qqemuxlyzkbjudzwmfid.supabase.co/rest/v1/category?id=eq.3300cbcc-fe02-4e0f-98df-8c57625379eb&apikey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFxZW11eGx5emtianVkendtZmlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDA2NTAxMDQsImV4cCI6MjAxNjIyNjEwNH0.sqBedeuuGl6Osr3UBg_y8kUep9eFwFr_SADIR1v_nHI
// https: const baseUrl = `${ origin }/${ params.id }`;
//qqemuxlyzkbjudzwmfid.supabase.co/rest/v1/category&apikey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFxZW11eGx5emtianVkendtZmlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDA2NTAxMDQsImV4cCI6MjAxNjIyNjEwNH0.sqBedeuuGl6Osr3UBg_y8kUep9eFwFr_SADIR1v_nHI

// import { Category } from "@/d.types";
// import { createSupabaseBrowser } from "@/supabase/client";
// import { useQuery } from "@tanstack/react-query";

// export default function useFetchCategories(storeId: string) {
// 	const supabase = createSupabaseBrowser();

// 	return useQuery({
// 		queryKey: ["categories"],
// 		queryFn: async () => {
// 			const { data: currentUser } = await supabase.auth.getUser();
// 			const id = currentUser.user?.id;

// 			if (id) {
// 				const { data: categories, error } = await supabase
// 					.from("category")
// 					.select("*")
// 					.eq("vendor_id", id)
// 					.eq("store_id", storeId);

// 				if (error) {
// 					console.error("Error fetching categories:", error);
// 					return [];
// 				}

// 				return categories as Category[];
// 			}
// 			return [];
// 		},
// 	});
// }


// // global imports
// import { CldUploadWidget } from "next-cloudinary";
// import { useEffect, useState } from "react";

// // local imports
// import Image from "next/image";
// import { Button } from "@/components/ui/button";
// import { ImagePlus, Plus, Trash } from "lucide-react";

// interface ImageUploadProps {
// 	disabled?: boolean;
// 	onChange: (value: string[]) => void;
// 	onRemove: (value: string) => void;
// 	value: string[];
// }

// export const MultipleImageUpload: React.FC<ImageUploadProps> = ({
// 	disabled,
// 	onChange,
// 	onRemove,
// 	value,
// }) => {
// 	// console.log("value : => ", value);
// 	const [isMounted, setIsMounted] = useState(false);

// 	useEffect(() => {
// 		setIsMounted(true);
// 	}, []);

// 	const onUpload = (result: any) => {
// 		// console.log(result);
// 		onChange(result?.info?.secure_url);
// 	};

// 	if (!isMounted) {
// 		return null;
// 	}
// 	return (
// 		<div>
// 			<div className="mb-4 flex items-center gap-4">
// 				{value?.map((url) => (
// 					<div
// 						key={url}
// 						className="relative rounded-md overflow-hidden border border-clr-3 border-dashed py-10"
// 					>
// 						<div className="z-10 absolute top-2 right-2">
// 							<Button
// 								type="button"
// 								onClick={() => onRemove(url)}
// 								variant="destructive"
// 								size="sm"
// 							>
// 								<Trash className="h-4 w-4" />
// 							</Button>
// 						</div>
// 						<Image
// 							height={200}
// 							width={200}
// 							className="object-cover w-[80px] sm:w-[150px] md:w-[200px]"
// 							alt="Image"
// 							src={url}
// 						/>
// 					</div>
// 				))}
// 			</div>
// 			<div className="flex items-center justify-center py-6 px-8 w-[500px] min-w-[350px]  h-[200px] rounded-md border border-clr-3 border-dotted bg-clr-2">
// 				<CldUploadWidget onSuccess={onUpload} uploadPreset="yselapnu">
// 					{({ open }) => {
// 						const onClick = () => {
// 							open();
// 						};

// 						return (
// 							<Button
// 								type="button"
// 								disabled={disabled}
// 								variant="secondary"
// 								onClick={onClick}
// 								className="flex items-center justify-center h-full w-full py-6 px-8 bg-clr-2 hover:bg-clr-2 "
// 							>
// 								<Plus className="h-4 w-4 mr-2" />
// 								Upload an image
// 							</Button>
// 						);
// 					}}
// 				</CldUploadWidget>
// 			</div>
// 		</div>
// 	);
// };

// // {
// // 	value ? (
// // 		<div className="relative rounded-md overflow-hidden border border-clr-3 border-dashed ">
// // 			<div className="z-10 absolute top-2 right-2">
// // 				<Button
// // 					type="button"
// // 					onClick={onRemove}
// // 					variant="destructive"
// // 					size="sm"
// // 				>
// // 					<Trash className="h-4 w-4" />
// // 				</Button>
// // 			</div>
// // 			<Image
// // 				height={200}
// // 				width={200}
// // 				className="object-cover w-[80px] sm:w-[150px] md:w-[200px]"
// // 				alt="Image"
// // 				src={value}
// // 			/>
// // 		</div>
// // 	) : (
// // 		<div className="flex items-center justify-center py-6 px-8 w-[500px] min-w-[350px]  h-[200px] rounded-md border border-clr-3 border-dotted bg-clr-2">
// // 			<CldUploadWidget onSuccess={onUpload} uploadPreset="yselapnu">
// // 				{({ open }) => {
// // 					const onClick = () => {
// // 						open();
// // 					};

// // 					return (
// // 						<Button
// // 							type="button"
// // 							disabled={disabled}
// // 							variant="secondary"
// // 							onClick={onClick}
// // 							className="flex items-center justify-center h-full w-full py-6 px-8 bg-clr-2 hover:bg-clr-2 "
// // 						>
// // 							<Plus className="h-4 w-4 mr-2" />
// // 							Upload an image
// // 						</Button>
// // 					);
// // 				}}
// // 			</CldUploadWidget>
// // 		</div>
// // 	);
// // }


// export interface Product {
// 	vendor_id: string;
// 	store_id: string;
// 	title: string;
// 	categoryId: string;
// 	collectionId: string | null;
// 	status: string;
// 	media: Media[];
// 	type: string;
// 	ribbon: string | null;
// 	brand?: string;
// 	price: number;
// 	on_sale?: boolean;
// 	cost_of_good?: number | null;
// 	inventory?: number | null;
// 	sku: string | null;
// 	description: string;
// 	additional_information?: KeyValuePair[] | null;
// 	variants?: Variant[] | null;
// }

// export interface Product {
// 	additional_information: Json | null;
// 	brand: string | null;
// 	category_id: string;
// 	collection_id: string | null;
// 	cost_of_good: number | null;
// 	created_at: string;
// 	description: string;
// 	id: string;
// 	ribbon: string | null;
// 	inventory: number | null;
// 	media: string[];
// 	on_sale: boolean;
// 	price: number;
// 	sku: string | null;
// 	status: string;
// 	store_id: string;
// 	title: string;
// 	type: string;
// 	variants: Json | null;
// 	vendor_id: string;
	slug: string | null;
// }
// export interface Product {
// 	additional_information: Record<string, any> | null;
// 	brand: string | null;
// 	category_id: string;
// 	collection_id: string | null;
// 	cost_of_good: number | null;
// 	created_at: string;
// 	description: string;
// 	id: string;
// 	ribbon: string | null;
// 	inventory: number | null;
// 	media: string[];
// 	on_sale: boolean;
// 	price: number;
// 	sku: string | null;
// 	status: string;
// 	store_id: string;
// 	title: string;
// 	type: string;
// 	variants: Record<string, any> | null;
// 	vendor_id: string;
// }





"use client"

import { zodResolver } from "@hookform/resolvers/zod"
import { useForm } from "react-hook-form"
import { z } from "zod"

import { Button } from "@/components/ui/button"
import { Checkbox } from "@/components/ui/checkbox"
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form"
import { toast } from "@/components/ui/use-toast"

const items = [
  {
    id: "recents",
    label: "Recents",
  },
  {
    id: "home",
    label: "Home",
  },
  {
    id: "applications",
    label: "Applications",
  },
  {
    id: "desktop",
    label: "Desktop",
  },
  {
    id: "downloads",
    label: "Downloads",
  },
  {
    id: "documents",
    label: "Documents",
  },
] as const

const FormSchema = z.object({
  items: z.array(z.string()).refine((value) => value.some((item) => item), {
    message: "You have to select at least one item.",
  }),
})

export function CheckboxReactHookFormMultiple() {
  const form = useForm<z.infer<typeof FormSchema>>({
    resolver: zodResolver(FormSchema),
    defaultValues: {
      items: ["recents", "home"],
    },
  })

  function onSubmit(data: z.infer<typeof FormSchema>) {
    toast({
      title: "You submitted the following values:",
      description: (
        <pre className="mt-2 w-[340px] rounded-md bg-slate-950 p-4">
          <code className="text-white">{JSON.stringify(data, null, 2)}</code>
        </pre>
      ),
    })
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-8">
        <FormField
          control={form.control}
          name="items"
          render={() => (
            <FormItem>
              <div className="mb-4">
                <FormLabel className="text-base">Sidebar</FormLabel>
                <FormDescription>
                  Select the items you want to display in the sidebar.
                </FormDescription>
              </div>
              {items.map((item) => (
                <FormField
                  key={item.id}
                  control={form.control}
                  name="items"
                  render={({ field }) => {
                    return (
                      <FormItem
                        key={item.id}
                        className="flex flex-row items-start space-x-3 space-y-0"
                      >
                        <FormControl>
                          <Checkbox
                            checked={field.value?.includes(item.id)}
                            onCheckedChange={(checked) => {
                              return checked
                                ? field.onChange([...field.value, item.id])
                                : field.onChange(
                                    field.value?.filter(
                                      (value) => value !== item.id
                                    )
                                  )
                            }}
                          />
                        </FormControl>
                        <FormLabel className="font-normal">
                          {item.label}
                        </FormLabel>
                      </FormItem>
                    )
                  }}
                />
              ))}
              <FormMessage />
            </FormItem>
          )}
        />
        <Button type="submit">Submit</Button>
      </form>
    </Form>
  )
}



<div className="md:flex hidden flex-col gap-4 bg-white p-2 rounded-lg">
								<FormField
									control={form.control}
									name="inventory"
									render={({ field }) => (
										<FormItem>
											<div className="flex items-center justify-between">
												<div>
													<FormLabel>Inventory</FormLabel>{" "}
													<span>
														<Badge className="ml-2" variant={"custom"}>
															Optional
														</Badge>
													</span>
												</div>
												<div>
													<HoverCard>
														<HoverCardTrigger>
															<Button
																variant={"outline"}
																className="rounded-full p-1 h-auto"
															>
																<FaQuestion className="w-3 h-3" />
															</Button>
														</HoverCardTrigger>
														<HoverCardContent>
															Track this product's inventory by adding stock
															quantities.
														</HoverCardContent>
													</HoverCard>
												</div>
											</div>

											<FormControl>
												<Input
													type="number"
													disabled={loading}
													placeholder="9.99"
													{...field}
													min={1}
												/>
											</FormControl>
											<FormMessage />
										</FormItem>
									)}
								/>
								{/* sku */}
								<FormField
									control={form.control}
									name="sku"
									render={({ field }) => (
										<FormItem>
											<div className="flex justify-between items-center">
												<div>
													<FormLabel>SKU</FormLabel>
													<span>
														<Badge className="ml-2" variant={"custom"}>
															Optional
														</Badge>
													</span>
												</div>
												<div>
													<HoverCard>
														<HoverCardTrigger>
															<Button
																variant={"outline"}
																className="rounded-full p-1 h-auto"
															>
																<FaQuestion className="w-3 h-3" />
															</Button>
														</HoverCardTrigger>
														<HoverCardContent>
															A “Stock Keeping Unit” is a unique code you can
															create for each product or variant you have in
															your store. Using SKUs helps with tracking
															inventory.
														</HoverCardContent>
													</HoverCard>
												</div>
											</div>
											<FormControl>
												<Input
													type="text"
													disabled={loading}
													placeholder="e.g, SKU123456789"
													{...field}
													min={1}
												/>
											</FormControl>
											<FormMessage />
										</FormItem>
									)}
								/>

								{/* type */}
								<FormField
									control={form.control}
									name="type"
									render={({ field }) => (
										<FormItem>
											<FormLabel>Type</FormLabel>
											<Select
												disabled={loading}
												onValueChange={field.onChange}
												value={field.value}
												defaultValue={field.value}
											>
												<FormControl>
													<SelectTrigger>
														<SelectValue
															defaultValue={field.value}
															placeholder="Select a product type"
														/>
													</SelectTrigger>
												</FormControl>
												<SelectContent>
													{typesOfproduct?.map((collection) => (
														<SelectItem
															key={collection.id}
															value={collection.value}
														>
															{collection.value}
														</SelectItem>
													))}
												</SelectContent>
											</Select>
											<FormMessage />
										</FormItem>
									)}
								/>
								{/* status */}
								<FormField
									control={form.control}
									name="status"
									render={({ field }) => (
										<FormItem>
											<FormLabel>Status</FormLabel>
											<Select
												disabled={loading}
												onValueChange={field.onChange}
												value={field.value}
												defaultValue={field.value}
											>
												<FormControl>
													<SelectTrigger>
														<SelectValue
															defaultValue={field.value}
															placeholder="select the availability"
														/>
													</SelectTrigger>
												</FormControl>
												<SelectContent>
													{productStatus?.map((collection) => (
														<SelectItem
															key={collection.id}
															value={collection.value}
														>
															{collection.value}
														</SelectItem>
													))}
												</SelectContent>
											</Select>
											<FormMessage />
										</FormItem>
									)}
								/>
								{/* Ribbon */}
								<FormField
									control={form.control}
									name="ribbon"
									render={({ field }) => (
										<FormItem>
											<div className="flex justify-between items-center">
												<div>
													<FormLabel>Ribbon</FormLabel>
													<span>
														<Badge className="ml-2" variant={"custom"}>
															Optional
														</Badge>
													</span>
												</div>
												<div>
													<HoverCard>
														<HoverCardTrigger>
															<Button
																variant={"outline"}
																className="rounded-full p-1 h-auto"
															>
																<FaQuestion className="w-3 h-3" />
															</Button>
														</HoverCardTrigger>
														<HoverCardContent>
															Add a label like “New Arrival” or “Sale” to make
															this product stand out. It’ll be displayed on your
															product widgets.
														</HoverCardContent>
													</HoverCard>
												</div>
											</div>

											<FormControl>
												<Input
													type="text"
													disabled={loading}
													placeholder="e.g, New arrival, On-Sale"
													{...field}
													min={1}
												/>
											</FormControl>
											<FormMessage />
										</FormItem>
									)}
								/>

								<FormField
									control={form.control}
									name="on_sale"
									render={({ field }) => (
										<FormItem className="flex flex-row items-start pl-2 py-4 space-x-3 space-y-0 border rounded-md">
											<FormControl>
												<Checkbox
													checked={field.value}
													onCheckedChange={field.onChange}
												/>
											</FormControl>
											<div className="space-y-1 leading-none">
												<FormLabel>On Sale</FormLabel>
												<FormDescription>
													Is this product being sold at a discount?
												</FormDescription>
											</div>
										</FormItem>
									)}
								/>
							</div>

                            // export interface Product {
// 	id: string;
// 	vendor_id: string;
// 	store_id: string;
// 	title: string;
// 	category_id: string;
// 	collection_id: string | null;
// 	status: string;
// 	media: string[];
// 	type: string;
// 	ribbon: string | null;
// 	brand: string | null;
// 	price: number;
// 	on_sale: boolean;
// 	cost_of_good: number | null;
// 	inventory: number | null;
// 	sku: string | null;
// 	description: string;
// 	additional_information: KeyValuePair[] | null;
// 	variants: Variant[] | null;
// 	created_at: string;
// 	slug: string | null;
// }









// app/api/graphql.ts
import { Category, Collection, Product } from "../../../types";
import { ApolloServer, gql } from "apollo-server-micro";
const Cors = require("micro-cors");
import { RequestHandler } from "micro";
// Define CORS options
const corsOptions = {
	origin: "*", // Replace with your client’s URL or '*'
	allowMethods: ["GET"],
	allowHeaders: ["Content-Type"],
	allowCredentials: true,
};

// Create CORS middleware
const cors = Cors(corsOptions);

const typeDefs = gql`
  type Media = {
    url: String
  }

  type VariantValue ={
    label: String
    value: String
  }

  type Variant= {
    title: String
    values: [VariantValue]
  }

  type AdditionalInformation = {
    title: String
    description: String
  }

 type Product = {
    id: String
    created_at: String
    vendor_id: String
    store_id: String
    title: String
    status: String
    media: [String]
    type: String
    brand: String
    price: GLfloat
    on_sale: Boolean
    cost_of_good: GLfloat
    inventory: String
    sku: String
    description: String
    additional_information: [AdditionalInformation]
    variants: [Variant]
    collection_id: String
    category_id: [String]
    ribbon: String
    slug: String
  }

  type Category = {
    id: String
    created_at: String
    store_id: String
    name: String
    description: String
    avatar: String
    vendor_id: String
    product_count: Number
    slug: String
    tags: [String]
  }

  type Collection = {
    id: String
    created_at: String
    store_id: String
    name: String
    description: String
    avatar: String
    vendor_id: String
    product_count: Number
    slug: String
    tags: [String]
  }
	type Query = {
		products(storeId: String!): [Product]
		categories(storeId: String!): [Category]
		collections(storeId: String!): [Collection]
		product(storeId: String!, productId: String!): Product
		category(storeId: String!, categoryId: String!): Category
		collection(storeId: String!, collectionId: String!): Collection
	}
`;

const resolvers = {
	Query: {
		products: async (
			_: any,
			{ storeId }: { storeId: string }
		): Promise<Product[]> => {
			const response = await fetch(`/api/${storeId}/products`);
			const products = await response.json();
			return products.map((product: any) => ({
				...product,
				additional_information: product.additional_information
					? JSON.parse(product.additional_information)
					: null,
				variants: product.variants ? JSON.parse(product.variants) : null,
			}));
		},

		categories: async (
			_: any,
			{ storeId }: { storeId: string }
		): Promise<Category[]> => {
			const response = await fetch(`/api/${storeId}/categories`);
			return response.json();
		},

		collections: async (
			_: any,
			{ storeId }: { storeId: string }
		): Promise<Collection[]> => {
			const response = await fetch(`/api/${storeId}/collections`);
			return response.json();
		},

		// Fetch a single product by its ID
		product: async (
			_: any,
			{ storeId, productId }: { storeId: string; productId: string }
		): Promise<Product> => {
			const response = await fetch(
				`http://localhost:3000/api/${storeId}/products/${productId}`
			);
			const product = await response.json();
			return {
				...product,
				additional_information: product.additional_information
					? JSON.parse(product.additional_information)
					: null,
				variants: product.variants ? JSON.parse(product.variants) : null,
			};
		},

		// Fetch a single category by its ID
		category: async (
			_: any,
			{ storeId, categoryId }: { storeId: string; categoryId: string }
		): Promise<Category> => {
			const response = await fetch(
				`http://localhost:3000/api/${storeId}/categories/${categoryId}`
			);
			return response.json();
		},

		// Fetch a single collection by its ID
		collection: async (
			_: any,
			{ storeId, collectionId }: { storeId: string; collectionId: string }
		): Promise<Collection> => {
			const response = await fetch(
				`http://localhost:3000/api/${storeId}/collections/${collectionId}`
			);
			return response.json();
		},
	},
};

const apolloServer = new ApolloServer({ typeDefs, resolvers });

// Create the GraphQL handler
const graphqlHandler: RequestHandler = apolloServer.createHandler({
	path: "/api/graphql",
});

// Apply CORS to the GraphQL handler
const corsEnabledHandler: RequestHandler = cors(graphqlHandler);

export const config = {
	api: {
		bodyParser: false,
	},
};
export default corsEnabledHandler;

// test
// query {
//     products(storeId: "57a4c8be-5547-42d1-bb43-ffc4e233108e") {
//       id
//       title
//       price
//       media
//       additional_information {
//         title
//         description
//       }
//       variants {
//         title
//         values {
//           label
//           value
//         }
//       }
//     }
//     categories(storeId: "30f87f20-5997-4923-a2d4-d54a98c47372") {
//       id
//       name
//       avatar
//     }
//     collections(storeId: "30f87f20-5997-4923-a2d4-d54a98c47372") {
//       id
//       name
//       avatar
//     }
//   }
